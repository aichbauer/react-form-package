---
name: Dynamic Fields 2
route: /dynamic-field-2
order: 10
---

import { Form, Button, Field, Select, RadioGroup } from '../src';
import { Playground } from 'docz';
import { data as checkboxData } from './data/checkboxes';
import { data as selectData } from './data/select';
import { data as radioData } from './data/radio';
import { DynamicFieldsOnChange } from './components/DynamicFieldsOnChange'
import { DynamicFieldsOnClick } from './components/DynamicFieldsOnClick'

# Dynamic Fields

> Note: Working with `dynamically added fields` will become easier in the future. Right now, this is only possible with rerendering the form with the old form data and adding the new field.

Sometimes you do not know how many fields your form should have, so you need a way to add dynamic fields on user events, e.g. on a button click if a user should decide if a new field is needed, or on a change of a field, e.g. when a field is filled a new field should appear.

## onChange

First off, import your components.

```js
import React from 'react';
import {
  Form,
  Field,
  Button,
} from 'react-form-package';
```

The next step is to create a `class` that will render our form. 

To add new form inputs dynamically we need to store a copy of our form values in the state of the parent component. This can be done via the `onChange` function (or `onBlur`, `onFocus`). 

Next step is to add a `ref` to our `<Form />` component, so that we are able to update the internal state of our `<Form />` component and add a new field. See `constructor` function and `<Form />` component.

Now we need to update the state of our parent component. See the `handleOnChange` function. We check if we add a index if there is a index we change the value in the index of the array or else we change the value of of the passed id.

The last step before rendering our form is to create a function that will add a new field to our array. See `handleAddField` function.

```jsx
const companyTemplate = {
  name: '',
};

class DynamicFieldsOnChange extends React.Component {
  constructor(props) {
    super(props);

    this.state = {
      text: '',
      companies: [
        companyTemplate,
      ],
    };

    // our reference to our form
    // so that we are able to update
    // the form state
    this.child = React.createRef();
  }

  handleAddCompany() {
    const { companies } = this.state;
    const { length } = companies;

    // if the last field is not empty add a new one
    // in the callback of our setState we create
    // the new state of our form via the new children
    // in this component
    // note that we use a ref here
    if (companies[length - 1].name) {
      this.setState({
        companies: companies.concat([companyTemplate]),
      }, () => this.child.current.updateState());
    }
  }

  handleOnChange(formState, id, index) {
    const { companies } = this.state;
    const myValue = formState.data[id];

    // if it is a dynamic field change the
    // value based on the index of this array
    if (!isNaN(index)) {
      const newCompanies = companies.map((company, idx) => {
        if (idx !== index) {
          return company;
        }

        const newCompany = {
          ...company,
          name: myValue,
        };

        return newCompany;
      });

      // in the callback we add a new field
      return this.setState({
        companies: newCompanies,
      }, () => this.handleAddCompany());
    }

    // else update the other fields
    // based on the id
    return this.setState({
      [id]: myValue,
    });
  }

  render() {
    const {
      text,
      companies,
    } = this.state;

    // - we need to pass the values
    //   of the state of this component
    // - we need to add our handleOnChange
    // - we need to set our ref
    return (
      <Form
        ref={this.child}
      >
        <div>
          <Field
            type="text"
            id="text"
            value={text}
            placeholder="Not a dynamic field"
            onChange={(state) => this.handleOnChange(state, 'text')}
          />
        </div>
        {/* render our dynamic fields */}
        {companies.map((company, idx) => (
          <div>
            <Field
              id={`company-${idx}`}
              value={company.name}
              placeholder={`Company ${idx}`}
              type="text"
              onChange={(state) => this.handleOnChange(state, `company-${idx}`, idx)}
            />
          </div>
        ))}
        <div>
          <Button
            id="submit"
            type="submit"
            onClick={(state) => {
              alert(JSON.stringify(state, null, 2));
              alert('open the console to see the whole state...');
              console.log(state);
            }}
          >
            Submit
          </Button>
        </div>
      </Form>
    );
  }
}

export { DynamicFieldsOnChange };
```

Now render this Component. Everytime you fill out a Company field a new one will appear. Also our Fields will be validated accoringly.

<Playground>
  <DynamicFieldsOnChange />
</Playground>

## onClick

First off, import your components.

```js
import React from 'react';
import {
  Form,
  Field,
  Button,
} from 'react-form-package';
```

The next step is to create a `class` that will render our form. 

Everything stays the same as in the example above, except:

* we do not call the `handleAddCompany` function in the `handleOnChange` function, instead we call it on a `onClick` of a button.
* we have a new `handleRemoveCompany` function that is also called on a `onClick` of another function.

```jsx
const companyTemplate = {
  name: '',
};

class DynamicFieldsOnClick extends React.Component {
  constructor(props) {
    super(props);

    this.state = {
      text: '',
      companies: [
        companyTemplate,
      ],
    };

    // our reference to our form
    // so that we are able to update
    // the form state
    this.child = React.createRef();
  }

  handleAddCompany() {
    const { companies } = this.state;

    // in the callback of our setState we create
    // the new state of our form via the new children
    // in this component
    // note that we use a ref here
    this.setState({
      companies: companies.concat([companyTemplate]),
    }, () => this.child.current.updateState());
  }

  handleRemoveCompany(idx) {
    const { companies } = this.state;

    // in the callback of our setState we create
    // the new state of our form via the new children
    // in this component
    // note that we use a ref here
    this.setState({
      companies: companies.filter((_, index) => idx !== index),
    }, () => this.child.current.updateState());
  }

  handleOnChange(formState, id, index) {
    const { companies } = this.state;
    const myValue = formState.data[id];

    // if it is a dynamic field change the
    // value based on the index of this array
    if (!isNaN(index)) {
      const newCompanies = companies.map((company, idx) => {
        if (idx !== index) {
          return company;
        }

        const newCompany = {
          ...company,
          name: myValue,
        };

        return newCompany;
      });

      // in the callback we add a new field
      return this.setState({
        companies: newCompanies,
      });
    }

    // else update the other fields
    // based on the id
    return this.setState({
      [id]: myValue,
    });
  }

  render() {
    const {
      text,
      companies,
    } = this.state;

    // - we need to pass the values
    //   of the state of this component
    // - we need to add our handleOnChange
    // - we need to set our ref
    return (
      <Form
        ref={this.child}
      >
        <div>
          <Field
            type="text"
            id="text"
            value={text}
            placeholder="Not a dynamic field"
            onChange={(state) => this.handleOnChange(state, 'text')}
          />
        </div>
        {/* render our dynamic fields */}
        {companies.map((company, idx) => (
          <div>
            <Field
              id={`company-${idx}`}
              value={company.name}
              placeholder={`Company ${idx}`}
              type="text"
              onChange={(state) => this.handleOnChange(state, `company-${idx}`, idx)}
            />
            <button
              type="button"
              onClick={() => this.handleRemoveCompany(idx)}
            >
              Remove Company
            </button>
          </div>
        ))}
        <div>
          <button
            type="button"
            onClick={() => this.handleAddCompany()}
          >
            Add Company
          </button>
        </div>
        <div>
          <Button
            id="submit"
            type="submit"
            onClick={(state) => {
              alert(JSON.stringify(state, null, 2));
              alert('open the console to see the whole state...');
              console.log(state);
            }}
          >
            Submit
          </Button>
        </div>
      </Form>
    );
  }
}

export { DynamicFieldsOnClick };
```

Now render this Component. Everytime you click on the button `Add Company` you get a new field, and everytime you click on the button `Remove Company` you remove the corresponding field.

<Playground>
  <DynamicFieldsOnClick />
</Playground>

